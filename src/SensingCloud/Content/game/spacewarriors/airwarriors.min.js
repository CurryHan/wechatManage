var res={bgMusic_mp3:"res/Music/bgMusic.mp3",bgMusic_ogg:"res/Music/bgMusic.ogg",buttonEffet_mp3:"res/Music/buttonEffet.mp3",buttonEffet_ogg:"res/Music/buttonEffet.ogg",explodeEffect_mp3:"res/Music/explodeEffect.mp3",explodeEffect_ogg:"res/Music/explodeEffect.ogg",fireEffect_mp3:"res/Music/fireEffect.mp3",fireEffect_ogg:"res/Music/fireEffect.ogg",mainMainMusic_mp3:"res/Music/mainMainMusic.mp3",mainMainMusic_ogg:"res/Music/mainMainMusic.ogg",shipDestroyEffect_mp3:"res/Music/shipDestroyEffect.mp3",shipDestroyEffect_ogg:"res/Music/shipDestroyEffect.ogg",arial_14_fnt:"res/arial-14.fnt",arial_14_png:"res/arial-14.png",b01_plist:"res/b01.plist",b01_png:"res/b01.png",explosion_plist:"res/explosion.plist",explosion_png:"res/explosion.png",flare_jpg:"res/flare.jpg",level01_tmx:"res/level01.tmx",loading_png:"res/loading.png",menu_png:"res/menu.png",progressBack_png:"res/hp_progressbarback.png",progressFront_png:"res/hp_progressbarfront.png",menuTitle_png:"res/menuTitle.png",displayTexturePack_plist:"res/displayTexturePack.plist",displayTexturePack_png:"res/displayTexturePack.png",textureOpaquePack_plist:"res/textureOpaquePack.plist",textureOpaquePack_png:"res/textureOpaquePack.png",textureTransparentPack_plist:"res/textureTransparentPack.plist",textureTransparentPack_png:"res/textureTransparentPack.png"},g_mainmenu=[res.loading_png,res.progressBack_png,res.progressFront_png,res.flare_jpg,res.menu_png,res.b01_png,res.displayTexturePack_png,res.textureTransparentPack_png,res.b01_plist,res.mainMainMusic_mp3,res.mainMainMusic_ogg,res.menuTitle_png,res.displayTexturePack_plist,res.textureTransparentPack_plist],g_maingame=[res.arial_14_png,res.explosion_png,res.textureOpaquePack_png,res.explosion_plist,res.textureOpaquePack_plist,res.bgMusic_mp3,res.bgMusic_ogg,res.buttonEffet_mp3,res.explodeEffect_mp3,res.fireEffect_mp3,res.shipDestroyEffect_mp3,res.buttonEffet_ogg,res.explodeEffect_ogg,res.fireEffect_ogg,res.shipDestroyEffect_ogg],MW=MW||{};MW.ShipMaxHP=5,MW.GAME_STATE={HOME:0,PLAY:1,OVER:2},MW.KEYS=[],MW.LEVEL={STAGE1:1,STAGE2:2,STAGE3:3},MW.LIFE=4,MW.SCORE=0,MW.SOUND=!0,MW.ENEMY_MOVE_TYPE={ATTACK:0,VERTICAL:1,HORIZONTAL:2,OVERLAP:3},MW.DELTA_X=-100,MW.OFFSET_X=-24,MW.ROT=-5.625,MW.BULLET_TYPE={PLAYER:1,ENEMY:2},MW.WEAPON_TYPE={ONE:1},MW.UNIT_TAG={ENMEY_BULLET:900,PLAYER_BULLET:901,ENEMY:1e3,PLAYER:1e3,SUPPLY:1001},MW.ENEMY_ATTACK_MODE={NORMAL:1,TSUIHIKIDAN:2},MW.LIFEUP_SORCE=[5e4,1e5,15e4,2e5,25e4,3e5],MW.CONTAINER={ENEMIES:[],ENEMY_BULLETS:[],PLAYER_BULLETS:[],EXPLOSIONS:[],SPARKS:[],HITS:[],BACKSKYS:[],BACKTILEMAPS:[]},MW.BULLET_SPEED={ENEMY:-200,SHIP:900},MW.ACTIVE_ENEMIES=0;var EnemyType=[{type:0,textureName:"enemy01.png",bulletType:"W2.png",HP:1,moveType:MW.ENEMY_MOVE_TYPE.ATTACK,attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,scoreValue:15},{type:1,textureName:"enemy02.png",bulletType:"W2.png",HP:2,moveType:MW.ENEMY_MOVE_TYPE.ATTACK,attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,scoreValue:40},{type:2,textureName:"enemy03.png",bulletType:"W2.png",HP:4,moveType:MW.ENEMY_MOVE_TYPE.HORIZONTAL,attackMode:MW.ENEMY_ATTACK_MODE.TSUIHIKIDAN,scoreValue:60},{type:3,textureName:"enemy04.png",bulletType:"W2.png",HP:6,moveType:MW.ENEMY_MOVE_TYPE.OVERLAP,attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,scoreValue:80},{type:4,textureName:"enemy05.png",bulletType:"W2.png",HP:10,moveType:MW.ENEMY_MOVE_TYPE.HORIZONTAL,attackMode:MW.ENEMY_ATTACK_MODE.TSUIHIKIDAN,scoreValue:150},{type:5,textureName:"enemy01.png",bulletType:"W2.png",HP:2,moveType:MW.ENEMY_MOVE_TYPE.ATTACK,attackMode:MW.ENEMY_MOVE_TYPE.VERTICAL,scoreValue:40}],SupplyType=[{type:0,textureName:"supply01.png",bulletType:"W2.png",HP:15,moveType:MW.ENEMY_MOVE_TYPE.HORIZONTAL,attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,scoreValue:200},{type:1,textureName:"supply02.png",bulletType:"W2.png",HP:15,moveType:MW.ENEMY_MOVE_TYPE.HORIZONTAL,attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,scoreValue:200},,{type:2,textureName:"supply03.png",bulletType:"W2.png",HP:15,moveType:MW.ENEMY_MOVE_TYPE.HORIZONTAL,attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,scoreValue:200}],Level1={enemyMax:6,enemies:[{ShowType:"Repeate",ShowTime:"00:02",Types:[0,1,2]},{ShowType:"Repeate",ShowTime:"00:05",Types:[3,4]},{ShowType:"Once",ShowTime:"00:08",Types:[0,3,4]}]},HitEffect=cc.Sprite.extend({active:!0,ctor:function(){this._super(),this.setSpriteFrame("hit.png"),this.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},reset:function(e,t,i){this.setPosition(e),this.setRotation(t),this.setScale(i),this.runAction(cc.ScaleBy.create(.3,2,2)),this.runAction(cc.Sequence.create(cc.FadeOut.create(.3),cc.CallFunc.create(this.destroy,this)))},destroy:function(){this.setVisible(!1),this.active=!1}});HitEffect.getOrCreateHitEffect=function(e,t,i){for(var r=null,c=0;c<MW.CONTAINER.HITS.length;c++)if(r=MW.CONTAINER.HITS[c],0==r.active)return r.setVisible(!0),r.active=!0,r.reset(e,t,i),r;return r=HitEffect.create(e,t,i),r.reset(e,t,i),r},HitEffect.create=function(){var e=new HitEffect;return g_sharedGameLayer.addBulletHits(e,9999),MW.CONTAINER.HITS.push(e),e},HitEffect.preSet=function(){for(var e=null,t=0;t<10;t++)e=HitEffect.create(),e.setVisible(!1),e.active=!1};var flareEffect=function(e,t,i){e.setVisible(!0),e.stopAllActions(),e.setBlendFunc(cc.SRC_ALPHA,cc.ONE),e.setOpacity(0),e.setPosition(-30,320),e.setRotation(-120),e.setScale(.2);var r=cc.FadeTo.create(.5,255),c=cc.FadeTo.create(1,0),a=cc.ScaleBy.create(.7,1.2,1.2),n=cc.EaseSineOut.create(a),s=cc.MoveBy.create(.5,cc.p(328,0)),o=cc.EaseSineOut.create(s),h=cc.RotateBy.create(2.5,90),l=cc.EaseExponentialOut.create(h),p=cc.ScaleTo.create(.5,1),u=cc.CallFunc.create(i,t),E=cc.CallFunc.create(function(){this.getParent().removeChild(this,!0)},e);e.runAction(cc.Sequence.create(r,n,c,E,u)),e.runAction(o),e.runAction(l),e.runAction(p)},removeFromParent=function(e){e.removeFromParent()},spark=function(e,t,i,r){i=i||.3,r=r||.5;var c=cc.Sprite.createWithSpriteFrameName("#explode1.png"),a=cc.Sprite.createWithSpriteFrameName("#explode2.png"),n=cc.Sprite.createWithSpriteFrameName("#explode3.png");c.setPosition(e),a.setPosition(e),n.setPosition(e),t.addSpark(a),t.addSpark(n),c.setScale(i),a.setScale(i),n.setScale(i),n.setRotation(360*Math.random());var s=cc.RotateBy.create(r,-45),o=cc.RotateBy.create(r,45),h=cc.ScaleBy.create(r,3,3),l=cc.FadeOut.create(r),p=cc.CallFunc.create(removeFromParent,this),u=cc.Sequence.create(l,p);c.runAction(s),a.runAction(o),c.runAction(h),a.runAction(h.clone()),n.runAction(h.clone()),c.runAction(u),a.runAction(u.clone()),n.runAction(u.clone())},SparkEffect=cc.Class.extend({active:!0,spark1:null,spark2:null,scale:1.2,duration:.7,ctor:function(){this.spark1=cc.Sprite.createWithSpriteFrameName("#explode2.png"),this.spark1.setBlendFunc(cc.SRC_ALPHA,cc.ONE),this.spark2=cc.Sprite.createWithSpriteFrameName("#explode3.png"),this.spark2.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},reset:function(e){this.spark1.setPosition(e),this.spark2.setPosition(e),this.spark1.setScale(this.scale),this.spark2.setScale(this.scale),this.spark2.setRotation(360*Math.random());var t=cc.RotateBy.create(this.duration,45),i=cc.ScaleBy.create(this.duration,3,3),r=cc.Sequence.create(cc.FadeOut.create(this.duration),cc.CallFunc.create(this.destroy,this));this.spark1.runAction(t),this.spark1.runAction(i),this.spark1.runAction(r),this.spark2.runAction(i.clone()),this.spark2.runAction(r.clone())},destroy:function(){this.active=!1,this.spark1.setVisible(!1),this.spark2.setVisible(!1)}});SparkEffect.getOrCreateSparkEffect=function(e){for(var t=null,i=0;i<MW.CONTAINER.SPARKS.length;i++)if(t=MW.CONTAINER.SPARKS[i],0==t.active)return t.active=!0,t.spark1.setVisible(!0),t.spark2.setVisible(!0),t.reset(e),t;var r=SparkEffect.create();return r.reset(e),r},SparkEffect.create=function(){var e=new SparkEffect;return g_sharedGameLayer.addSpark(e.spark1),g_sharedGameLayer.addSpark(e.spark2),MW.CONTAINER.SPARKS.push(e),e},SparkEffect.preSet=function(){for(var e=null,t=0;t<6;t++)e=SparkEffect.create(),e.active=!1,e.spark1.setVisible(!1),e.spark2.setVisible(!1)};var Explosion=cc.Sprite.extend({tmpWidth:0,tmpHeight:0,active:!0,animation:null,ctor:function(){this._super();var e=cc.spriteFrameCache.getSpriteFrame("explosion_01.png");this.setSpriteFrame(e),this.setBlendFunc(cc.SRC_ALPHA,cc.ONE);var t=this.getContentSize();this.tmpWidth=t.width,this.tmpHeight=t.height,this.animation=cc.animationCache.getAnimation("Explosion")},play:function(){this.runAction(cc.Sequence.create(cc.Animate.create(this.animation),cc.CallFunc.create(this.destroy,this)))},destroy:function(){this.setVisible(!1),this.active=!1}});Explosion.sharedExplosion=function(){for(var e=[],t="",i=1;i<35;i++){t="explosion_"+(i<10?"0"+i:i)+".png";var r=cc.spriteFrameCache.getSpriteFrame(t);e.push(r)}var c=cc.Animation.create(e,.04);cc.animationCache.addAnimation(c,"Explosion")},Explosion.getOrCreateExplosion=function(){for(var e=null,t=0;t<MW.CONTAINER.EXPLOSIONS.length;t++){var e=MW.CONTAINER.EXPLOSIONS[t];if(0==e.active)return e.setVisible(!0),e.active=!0,e.play(),e}return e=Explosion.create(),e.play(),e},Explosion.create=function(){var e=new Explosion;return g_sharedGameLayer.addExplosions(e),MW.CONTAINER.EXPLOSIONS.push(e),e},Explosion.preSet=function(){for(var e=null,t=0;t<6;t++)e=Explosion.create(),e.setVisible(!1),e.active=!1};var BackSky=cc.Sprite.extend({active:!0,ctor:function(e){this._super(),this.setSpriteFrame(e),this.setAnchorPoint(0,0)},destroy:function(){this.setVisible(!1),this.active=!1}});BackSky.create=function(e){var t=new BackSky(e);return g_sharedGameLayer.addChild(t,-10),MW.CONTAINER.BACKSKYS.push(t),t},BackSky.getOrCreate=function(){for(var e=null,t=0;t<MW.CONTAINER.BACKSKYS.length;t++)if(e=MW.CONTAINER.BACKSKYS[t],0==e.active)return e.setVisible(!0),e.active=!0,e;return e=BackSky.create()},BackSky.preSet=function(){var e=null;e=BackSky.create("bg01.png"),e.setVisible(!1),e.active=!1;var t=null;t=BackSky.create("bg02.png"),t.setVisible(!1),t.active=!1};var BackTileMapLvl1=["lvl1_map1.png","lvl1_map2.png","lvl1_map3.png","lvl1_map4.png"],BackTileMap=cc.Sprite.extend({active:!0,ctor:function(e){this._super(),this.setSpriteFrame(e),this.setAnchorPoint(.5,0)},destroy:function(){this.setVisible(!1),this.active=!1}});BackTileMap.create=function(e){var t=new BackTileMap(e);return g_sharedGameLayer.addChild(t,-9),MW.CONTAINER.BACKTILEMAPS.push(t),t},BackTileMap.getOrCreate=function(){for(var e=null,t=0;t<MW.CONTAINER.BACKTILEMAPS.length;t++)if(e=MW.CONTAINER.BACKTILEMAPS[t],0==e.active)return e.setVisible(!0),e.active=!0,e;return e=BackTileMap.create(BackTileMapLvl1[0|4*Math.random()])},BackTileMap.preSet=function(){for(var e=null,t=0;t<BackTileMapLvl1.length;t++)e=BackTileMap.create(BackTileMapLvl1[t]),e.setVisible(!1),e.active=!1};var LifesLayer=cc.Layer.extend({lifeNum:3,init:function(){var e=!1;if(this._super()){for(var t=0;t<this.lifeNum-1;t++){var i=cc.Sprite.createWithTexture("#hero01.png");i.setScale(.6),i.setAnchorPoint(1,0),i.setPosition(35*t,10),this.addChild(i,1e3,5)}e=!0}return e},setLifeNum:function(e){if(this.lifeNum!==e){this.lifeNum=e,this.removeAllChildren();for(var t=0;t<this.lifeNum-1;t++){var i=cc.Sprite.createWithTexture("#hero01.png");i.setScale(.6),i.setAnchorPoint(1,0),i.setPosition(105-35*t,10),this.addChild(i,1e3,5)}}}});LifesLayer.create=function(){var e=new LifesLayer;return e&&e.init()?e:null};var Bullet=cc.Sprite.extend({active:!0,xVelocity:0,yVelocity:200,power:1,HP:1,moveType:null,zOrder:3e3,attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,parentType:MW.BULLET_TYPE.PLAYER,ctor:function(e,t,i){this._super(),this.yVelocity=-e,this.attackMode=i,this.setSpriteFrame(t),this.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},update:function(e){var t=this.getPosition();this.setPosition(t.x-this.xVelocity*e,t.y-this.yVelocity*e),(t.x<0||t.x>g_sharedGameLayer.screenRect.width||t.y<0||t.y>g_sharedGameLayer.screenRect.height||this.HP<=0)&&this.destroy()},destroy:function(){HitEffect.getOrCreateHitEffect(this.getPosition(),360*Math.random(),.75);this.active=!1,this.setVisible(!1)},hurt:function(){this.HP--},collideRect:function(e){return cc.rect(e.x-3,e.y-3,6,6)}});Bullet.getOrCreateBullet=function(e,t,i,r,c){var a=null;if(c==MW.UNIT_TAG.PLAYER_BULLET){for(var n=0;n<MW.CONTAINER.PLAYER_BULLETS.length;n++)if(a=MW.CONTAINER.PLAYER_BULLETS[n],0==a.active)return a.setVisible(!0),a.HP=1,a.active=!0,a}else for(var n=0;n<MW.CONTAINER.ENEMY_BULLETS.length;n++)if(a=MW.CONTAINER.ENEMY_BULLETS[n],0==a.active)return a.setVisible(!0),a.HP=1,a.active=!0,a;return a=Bullet.create(e,t,i,r,c)},Bullet.create=function(e,t,i,r,c){var a=new Bullet(e,t,i);return g_sharedGameLayer.addBullet(a,r,c),c==MW.UNIT_TAG.PLAYER_BULLET?MW.CONTAINER.PLAYER_BULLETS.push(a):MW.CONTAINER.ENEMY_BULLETS.push(a),a},Bullet.preSet=function(){for(var e=null,t=0;t<10;t++){var e=Bullet.create(MW.BULLET_SPEED.SHIP,"W1.png",MW.ENEMY_ATTACK_MODE.NORMAL,3e3,MW.UNIT_TAG.PLAYER_BULLET);e.setVisible(!1),e.active=!1}for(var t=0;t<10;t++)e=Bullet.create(MW.BULLET_SPEED.ENEMY,"W2.png",MW.ENEMY_ATTACK_MODE.NORMAL,3e3,MW.UNIT_TAG.ENMEY_BULLET),e.setVisible(!1),e.active=!1};var Enemy=cc.Sprite.extend({eID:0,enemyType:1,active:!0,speed:200,bulletSpeed:MW.BULLET_SPEED.ENEMY,HP:15,bulletPowerValue:1,moveType:null,scoreValue:200,zOrder:1e3,delayTime:1+1.2*Math.random(),attackMode:MW.ENEMY_MOVE_TYPE.NORMAL,_hurtColorLife:0,ctor:function(e){this._super(),this.HP=e.HP,this.moveType=e.moveType,this.scoreValue=e.scoreValue,this.attackMode=e.attackMode,this.enemyType=e.type,this.setSpriteFrame(e.textureName),this.schedule(this.shoot,this.delayTime)},_timeTick:0,update:function(e){var t=this.getPosition();(t.x<0||t.x>320)&&(t.y<0||t.y>568)&&(this.active=!1),this._timeTick+=e,this._timeTick>.1&&(this._timeTick=0,this._hurtColorLife>0&&this._hurtColorLife--);var t=this.getPosition();(t.x<-10||t.x>g_sharedGameLayer.screenRect.width+10||t.y<0||t.y>g_sharedGameLayer.screenRect.height)&&(this.active=!1,this.innerDestroy()),this.HP<=0&&(this.active=!1,this.destroy())},innerDestroy:function(){this.setVisible(!1),this.active=!1,this.stopAllActions(),this.unschedule(this.shoot),MW.ACTIVE_ENEMIES--},destroy:function(){MW.SCORE+=this.scoreValue;var e=Explosion.getOrCreateExplosion();e.setPosition(this.getPosition()),SparkEffect.getOrCreateSparkEffect(this.getPosition()),MW.SOUND&&cc.audioEngine.playEffect(res.explodeEffect_mp3),this.setVisible(!1),this.active=!1,this.stopAllActions(),this.unschedule(this.shoot),MW.ACTIVE_ENEMIES--},shoot:function(){var e=this.getPosition();if(this.enemyType>=3){var t=Bullet.getOrCreateBullet(this.bulletSpeed,"W2.png",this.attackMode,3e3,MW.UNIT_TAG.ENMEY_BULLET),i=Bullet.getOrCreateBullet(this.bulletSpeed,"W2.png",this.attackMode,3e3,MW.UNIT_TAG.ENMEY_BULLET);t.setPosition(e.x-10,e.y-.2*this.getContentSize().height),i.setPosition(e.x+10,e.y-.2*this.getContentSize().height)}else{var r=Bullet.getOrCreateBullet(this.bulletSpeed,"W2.png",this.attackMode,3e3,MW.UNIT_TAG.ENMEY_BULLET);r.setPosition(e.x,e.y-.2*this.getContentSize().height)}},hurt:function(){this._hurtColorLife=2,this.HP--},collideRect:function(e){var t=this.getContentSize();return cc.rect(e.x-t.width/2,e.y-t.height/4,t.width,t.height/2+20)}});Enemy.getOrCreateEnemy=function(e){for(var t=null,i=0;i<MW.CONTAINER.ENEMIES.length;i++)if(t=MW.CONTAINER.ENEMIES[i],0==t.active&&t.enemyType==e.type)return t.HP=e.HP,t.active=!0,t.moveType=e.moveType,t.scoreValue=e.scoreValue,t.attackMode=e.attackMode,t._hurtColorLife=0,t.schedule(t.shoot,t.delayTime),t.setVisible(!0),MW.ACTIVE_ENEMIES++,t;return t=Enemy.create(e),MW.ACTIVE_ENEMIES++,t},Enemy.create=function(e){var t=new Enemy(e);return g_sharedGameLayer.addEnemy(t,t.zOrder,MW.UNIT_TAG.ENEMY),MW.CONTAINER.ENEMIES.push(t),t},Enemy.preSet=function(){for(var e=null,t=0;t<3;t++)for(var t=0;t<EnemyType.length;t++)e=Enemy.create(EnemyType[t]),e.setVisible(!1),e.active=!1,e.stopAllActions(),e.unscheduleAllCallbacks()};var Ship=cc.Sprite.extend({speed:220,bulletSpeed:MW.BULLET_SPEED.SHIP,HP:MW.ShipMaxHP,bulletTypeValue:1,bulletPowerValue:1,throwBombing:!1,canBeAttack:!0,isThrowingBomb:!1,zOrder:3e3,maxBulletPowerValue:4,appearPosition:cc.p(160,60),_hurtColorLife:0,active:!0,bornSprite:null,ctor:function(){this._super(),this.setSpriteFrame("hero02.png"),this.setTag(this.zOrder),this.setPosition(this.appearPosition);var e=cc.spriteFrameCache.getSpriteFrame("hero02.png"),t=cc.spriteFrameCache.getSpriteFrame("hero03.png"),i=[];i.push(e),i.push(t);var r=cc.Animation.create(i,.1),c=cc.Animate.create(r);this.runAction(cc.RepeatForever.create(c)),this.schedule(this.shoot,1/6),this.initBornSprite(),this.born()},update:function(e){if("browser"==cc.platform){var t=this.getPosition();(MW.KEYS[cc.KEY.w]||MW.KEYS[cc.KEY.up])&&t.y<=winSize.height&&(t.y+=e*this.speed),(MW.KEYS[cc.KEY.s]||MW.KEYS[cc.KEY.down])&&t.y>=0&&(t.y-=e*this.speed),(MW.KEYS[cc.KEY.a]||MW.KEYS[cc.KEY.left])&&t.x>=0&&(t.x-=e*this.speed),(MW.KEYS[cc.KEY.d]||MW.KEYS[cc.KEY.right])&&t.x<=winSize.width&&(t.x+=e*this.speed),this.setPosition(t)}this.HP<=0&&(this.active=!1,this.destroy()),this._timeTick+=e,this._timeTick>.1&&(this._timeTick=0,this._hurtColorLife>0&&this._hurtColorLife--)},shoot:function(e){var t=20,i=this.getPosition(),r=this.getContentSize(),c=Bullet.getOrCreateBullet(this.bulletSpeed,"W1.png",MW.ENEMY_ATTACK_MODE.NORMAL,3e3,MW.UNIT_TAG.PLAYER_BULLET);c.setPosition(i.x+t,i.y+3+.3*r.height);var a=Bullet.getOrCreateBullet(this.bulletSpeed,"W1.png",MW.ENEMY_ATTACK_MODE.NORMAL,3e3,MW.UNIT_TAG.PLAYER_BULLET);a.setPosition(i.x-t,i.y+3+.3*r.height)},destroy:function(){MW.LIFE--;var e=Explosion.getOrCreateExplosion();e.setPosition(this.getPosition()),MW.SOUND&&cc.audioEngine.playEffect(res.shipDestroyEffect_mp3)},hurt:function(){this.canBeAttack&&(this._hurtColorLife=2,this.HP--)},collideRect:function(e){var t=this.getContentSize();return cc.rect(e.x-t.width/2,e.y-t.height/2,t.width,t.height/2)},initBornSprite:function(){this.bornSprite=cc.Sprite.createWithSpriteFrameName("#hero01.png"),this.bornSprite.setBlendFunc(cc.SRC_ALPHA,cc.ONE),this.bornSprite.setPosition(this.getContentSize().width/2,40),this.addChild(this.bornSprite,3e3,99999)},born:function(){this.canBeAttack=!1,this.bornSprite.setScale(8),this.bornSprite.setVisible(!0),this.bornSprite.runAction(cc.ScaleTo.create(1,1,1));var e=cc.Blink.create(3,9),t=cc.CallFunc.create(function(e){e.canBeAttack=!0,e.setVisible(!0),e.bornSprite.setVisible(!1)}.bind(this));this.runAction(cc.Sequence.create(cc.DelayTime.create(1),e,t)),this.HP=MW.ShipMaxHP,this._hurtColorLife=0,this.active=!0},move:function(e){var t=e.getDelta(),i=this.getPosition();i=cc.pAdd(i,t),i=cc.pClamp(i,cc.p(0,0),cc.p(winSize.width,winSize.height)),this.setPosition(i)}}),SettingsLayer=cc.Layer.extend({init:function(){var e=!1;if(this._super()){var t=cc.Sprite.create(res.loading_png);t.setAnchorPoint(0,0),this.addChild(t,0,1);var i=cc.Sprite.createWithSpriteFrame("#game_way.png");i.setPosition(winSize.width/2,winSize.height-100),this.addChild(i);var r=cc.Sprite.createWithSpriteFrame("#game_des.png");r.setPosition(winSize.width/2,winSize.height-200),this.addChild(r);var c=cc.Sprite.create(res.menu_png,cc.rect(133,0,133,48)),a=cc.Sprite.create(res.menu_png,cc.rect(133,48,133,48)),n=cc.Sprite.create(res.menu_png,cc.rect(133,96,133,48)),s=cc.Sprite.create(res.flare_jpg);this.addChild(s),s.setVisible(!1);var o=cc.MenuItemSprite.create(c,a,n,function(){flareEffect(s,this,this.onNewGame)}.bind(this)),h=cc.Menu.create(o);h.alignItemsVerticallyWithPadding(10),this.addChild(h,1,2),h.setPosition(winSize.width/2,winSize.height/2-80),e=!0}return e},onNewGame:function(e){cc.LoaderScene.preload(g_maingame,function(){var e=cc.Scene.create();e.addChild(GameLayer.create()),cc.director.runScene(e)},this)},onBackCallback:function(e){var t=cc.Scene.create();t.addChild(SysMenu.create()),cc.director.runScene(t)},onSoundControl:function(){MW.SOUND=!MW.SOUND;var e=cc.audioEngine;MW.SOUND?e.playMusic(res.mainMainMusic_mp3):e.stopMusic()},onModeControl:function(){}});SettingsLayer.create=function(){var e=new SettingsLayer;return e&&e.init()?e:null};var LevelManager=cc.Class.extend({_currentLevel:null,_gameLayer:null,ctor:function(e){if(!e)throw"gameLayer must be non-nil";this._currentLevel=Level1,this._gameLayer=e,this.setLevel(this._currentLevel)},setLevel:function(e){for(var t=this._currentLevel.enemies,i=0;i<e.enemies.length;i++)t[i].ShowTime=this._minuteToSecond(t[i].ShowTime)},_minuteToSecond:function(e){if(!e)return 0;if("number"!=typeof e){var t=e.split(":");return 1==t.length?parseInt(t[0],10):60*parseInt(t[0],10)+parseInt(t[1],10)}return e},loadLevelResource:function(e){if(!(MW.ACTIVE_ENEMIES>=this._currentLevel.enemyMax))for(var t=this._currentLevel,i=0;i<t.enemies.length;i++){var r=t.enemies[i];if(r)if("Once"===r.ShowType){if(r.ShowTime==e)for(var c=0;c<r.Types.length;c++)this.addEnemyToGameLayer(r.Types[c])}else if("Repeate"===r.ShowType&&e%r.ShowTime===0)for(var a=0;a<r.Types.length;a++)this.addEnemyToGameLayer(r.Types[a])}},addEnemyToGameLayer:function(e){var t=Enemy.getOrCreateEnemy(EnemyType[e]),i=cc.p(80+(winSize.width-160)*Math.random(),winSize.height),r=t.getContentSize();t.setPosition(i);var c,a,n=0,s=0;switch(t.moveType){case MW.ENEMY_MOVE_TYPE.ATTACK:var o=this._gameLayer._ship.getPosition(),h=o.x-i.x,l=o.y-i.y;if(0==h)c=cc.p(i.x,-1);else{var p=o.y-l/h*o.x;c=cc.p(-(1+p)*h/l,-1)}a=cc.MoveTo.create(1,c);break;case MW.ENEMY_MOVE_TYPE.VERTICAL:c=cc.p(0,-winSize.height-r.height),a=cc.MoveBy.create(2,c);break;case MW.ENEMY_MOVE_TYPE.HORIZONTAL:c=cc.p(0,-100-200*Math.random()),n=cc.MoveBy.create(.5,c),s=cc.MoveBy.create(1,cc.p(-50-100*Math.random(),-50));var u=cc.CallFunc.create(function(e){var t=cc.DelayTime.create(1),i=cc.MoveBy.create(1,cc.p(100+100*Math.random(),-50));e.runAction(cc.RepeatForever.create(cc.Sequence.create(t,i,t.clone(),i.repeatForever())))}.bind(t));a=cc.Sequence.create(n,s,u);break;case MW.ENEMY_MOVE_TYPE.OVERLAP:var E=i.x<=winSize.width/2?320:-320;n=cc.MoveBy.create(4,cc.p(E,-240)),s=cc.MoveBy.create(4,cc.p(-E,-320)),a=cc.Sequence.create(n,s)}t.runAction(a),t.shoot()}}),GameOver=cc.Layer.extend({_ship:null,_lbScore:0,init:function(){var e=!1;if(this._super()){var t=cc.Sprite.create(res.loading_png);t.setAnchorPoint(0,0),this.addChild(t,0,1);var i=cc.Sprite.create("#game_over.png");i.setAnchorPoint(0,1),i.setPosition(0,450),this.addChild(i,10,1);var r=cc.Sprite.create(res.menu_png,cc.rect(266,0,133,48)),c=cc.Sprite.create(res.menu_png,cc.rect(266,48,133,48)),a=cc.Sprite.create(res.menu_png,cc.rect(266,96,133,48)),n=cc.Sprite.create(res.flare_jpg);this.addChild(n),n.setVisible(!1);var s=cc.MenuItemSprite.create(r,c,a,function(){flareEffect(n,this,this.onPlayAgain)}.bind(this)),o=cc.Menu.create(s);this.addChild(o,1,2),o.setPosition(winSize.width/2,200);var h=cc.Sprite.create("#coin.png");h.setPosition(winSize.width/2-20,280),this.addChild(h,10,1);var l=cc.LabelTTF.create(MW.SCORE,"Arial Bold",25);l.setPosition(winSize.width/2+30,280),l.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),l.setColor(cc.color(253,195,61,255)),this.addChild(l,10);var p=cc.Sprite.createWithSpriteFrameName("#powered_by.png");p.setPosition(winSize.width/2,25),this.addChild(p,10,1),MW.SOUND&&cc.audioEngine.playMusic(res.mainMainMusic_mp3),e=!0}return e},onPlayAgain:function(e){var t=cc.Scene.create();t.addChild(GameLayer.create()),cc.director.runScene(t)}});GameOver.create=function(){var e=new GameOver;return e&&e.init()?e:null},GameOver.scene=function(){var e=cc.Scene.create(),t=GameOver.create();return e.addChild(t),e},STATE_PLAYING=0,STATE_GAMEOVER=1,MAX_CONTAINT_WIDTH=40,MAX_CONTAINT_HEIGHT=40;var g_sharedGameLayer,GameLayer=cc.Layer.extend({_time:null,_ship:null,_backSky:null,_backSkyHeight:0,_backSkyRe:null,_levelManager:null,_tmpScore:0,_isBackSkyReload:!1,_isBackTileReload:!1,lbScore:null,screenRect:null,explosionAnimation:[],_beginPos:cc.p(0,0),_state:STATE_PLAYING,_explosions:null,_texOpaqueBatch:null,_texTransparentBatch:null,_lifeLayer:null,_displayFrame:null,musicToggle:null,mProgressBgSpr:null,mProgressSpr:null,init:function(){var e=!1;if(this._super()){cc.spriteFrameCache.addSpriteFrames(res.textureOpaquePack_plist),cc.spriteFrameCache.addSpriteFrames(res.b01_plist),MW.CONTAINER.ENEMIES=[],MW.CONTAINER.ENEMY_BULLETS=[],MW.CONTAINER.PLAYER_BULLETS=[],MW.CONTAINER.EXPLOSIONS=[],MW.CONTAINER.SPARKS=[],MW.CONTAINER.HITS=[],MW.CONTAINER.BACKSKYS=[],MW.CONTAINER.BACKTILEMAPS=[],MW.ACTIVE_ENEMIES=0,MW.SCORE=0,MW.LIFE=4,this._state=STATE_PLAYING;var t=cc.textureCache.addImage(res.textureOpaquePack_png);this._texOpaqueBatch=cc.Sprite.create(),this._texOpaqueBatch.setTexture(t),this._texOpaqueBatch.setBlendFunc(cc.SRC_ALPHA,cc.ONE),this.addChild(this._texOpaqueBatch);var i=cc.textureCache.addImage(res.textureTransparentPack_png);this._texTransparentBatch=cc.Sprite.create(),this._texTransparentBatch.setTexture(i),this.addChild(this._texTransparentBatch),winSize=cc.director.getWinSize(),this._levelManager=new LevelManager(this),this.screenRect=cc.rect(0,0,winSize.width,winSize.height+10),this._displayFrame=cc.Sprite.createWithSpriteFrame("#game_display.png"),this._displayFrame.setAnchorPoint(0,1),this._displayFrame.setPosition(0,cc.director.getVisibleSize().height-5),this.addChild(this._displayFrame,1e3),this.lbScore=cc.LabelTTF.create("0","Arial Bold",20),this.lbScore.setAnchorPoint(1,0),this.lbScore.setColor(cc.color(253,195,61,255)),this.lbScore.setHorizontalAlignment(cc.TEXT_ALIGNMENT_RIGHT),this.addChild(this.lbScore,1e3),this.lbScore.setPosition(winSize.width/2+60,winSize.height-35);var r=cc.Sprite.create("#sound_open.png"),c=cc.Sprite.create("#sound_close.png");this.musicToggle=cc.MenuItemToggle.create(cc.MenuItemSprite.create(r),cc.MenuItemSprite.create(c)),this.musicToggle.setCallback(this.onSoundControl);var a=MW.SOUND?0:1;this.musicToggle.setSelectedIndex(a),this.musicToggle.runAction(cc.rotateBy(1,180,180).repeatForever());var n=cc.Menu.create(this.musicToggle);n.setPosition(winSize.width-20,winSize.height-22),this.addChild(n,1e4),this.mProgressBgSpr=cc.Sprite.create(res.progressBack_png),this.mProgressBgSpr.setAnchorPoint(0,.5),this.mProgressBgSpr.setPosition(30,winSize.height-22),this.addChild(this.mProgressBgSpr,1e3),this.mProgressSpr=cc.Sprite.createWithTexture(res.progressFront_png),this.mVisibleRect=cc.rect(0,0,83,11),this.mProgressSpr.setAnchorPoint(0,.5),this.mProgressSpr.setPosition(30,winSize.height-22),this.mProgressSpr.setTextureRect(this.mVisibleRect),this.addChild(this.mProgressSpr,1e3),this._lifeLayer=LifesLayer.create(),this._lifeLayer.setAnchorPoint(0,1),this._lifeLayer.setPosition(200,10),this.addChild(this._lifeLayer,1e3,5),cc.spriteFrameCache.addSpriteFrames(res.explosion_plist);cc.textureCache.addImage(res.explosion_png);this._explosions=cc.Sprite.create(),this._explosions.setBlendFunc(cc.SRC_ALPHA,cc.ONE),this.addChild(this._explosions),Explosion.sharedExplosion(),this._ship=new Ship,this._texTransparentBatch.addChild(this._ship,this._ship.zOrder,MW.UNIT_TAG.PLAYER),cc.sys.capabilities.hasOwnProperty("keyboard")&&cc.sys.capabilities.hasOwnProperty("mouse")&&cc.sys.capabilities.hasOwnProperty("touches")&&cc.eventManager.addListener({event:cc.EventListener.TOUCH_ALL_AT_ONCE,onTouchesMoved:function(e,t){var i=t.getCurrentTarget(),r=e[0];i.move(r)}},this._ship),this.scheduleUpdate(),this.schedule(this.scoreCounter,1),MW.SOUND&&cc.audioEngine.playMusic(res.bgMusic_mp3,!0),e=!0,g_sharedGameLayer=this,Bullet.preSet(),Enemy.preSet(),HitEffect.preSet(),SparkEffect.preSet(),Explosion.preSet(),BackSky.preSet(),BackTileMap.preSet(),this.initBackground()}return e},updateProgress:function(){var e=0;void 0===this._ship||null==this._ship||(e=this._ship.HP/MW.ShipMaxHP),e>1?e=1:e<0&&(e=0);var t=83*e;this.mVisibleRect=cc.rect(0,0,t,11),this.mProgressSpr.setTextureRect(this.mVisibleRect)},onSoundControl:function(){MW.SOUND=!MW.SOUND;var e=cc.audioEngine;MW.SOUND?e.playMusic(res.mainMainMusic_mp3):e.stopMusic()},initBackground:function(){this._backSky=BackSky.getOrCreate(),this._backSkyHeight=this._backSky.getContentSize().height,this.moveTileMap(),this.schedule(this.moveTileMap,5)},moveTileMap:function(){var e=BackTileMap.getOrCreate(),t=Math.random();e.setPosition(320*t,winSize.height);var i=cc.MoveBy.create(2*t+10,cc.p(0,-winSize.height-240)),r=cc.CallFunc.create(function(){e.destroy()},this);e.runAction(cc.Sequence.create(i,r))},update:function(e){this._state==STATE_PLAYING&&(this.checkIsCollide(),this.removeInactiveUnit(e),this.checkIsReborn(),this.updateUI(),this._movingBackground(e))},checkIsCollide:function(){var e,t,i,r=this._ship;for(i=0;i<MW.CONTAINER.ENEMIES.length;i++)if(e=MW.CONTAINER.ENEMIES[i],e.active){for(var c=0;c<MW.CONTAINER.PLAYER_BULLETS.length;c++)t=MW.CONTAINER.PLAYER_BULLETS[c],t.active&&this.collide(e,t)&&(t.hurt(),e.hurt());this.collide(e,r)&&r.active&&(e.hurt(),r.hurt())}for(i=0;i<MW.CONTAINER.ENEMY_BULLETS.length;i++)e=MW.CONTAINER.ENEMY_BULLETS[i],e.active&&this.collide(e,r)&&r.active&&(e.hurt(),r.hurt())},removeInactiveUnit:function(e){var t,i=this._texOpaqueBatch.getChildren();for(var r in i)t=i[r],t&&t.active&&t.update(e);i=this._texTransparentBatch.getChildren();for(r in i)t=i[r],t&&t.active&&t.update(e)},checkIsReborn:function(){var e=this._ship;MW.LIFE>0&&!e.active?e.born():MW.LIFE<=0&&!e.active&&(this._state=STATE_GAMEOVER,this._ship=null,this.runAction(cc.Sequence.create(cc.DelayTime.create(.2),cc.CallFunc.create(this.onGameOver,this))))},updateUI:function(){this._tmpScore<MW.SCORE&&(this._tmpScore+=1),this._lifeLayer.setLifeNum(MW.LIFE),this.lbScore.setString(this._tmpScore),this.updateProgress()},collide:function(e,t){var i=e.getPosition(),r=t.getPosition();if(Math.abs(i.x-r.x)>MAX_CONTAINT_WIDTH||Math.abs(i.y-r.y)>MAX_CONTAINT_HEIGHT)return!1;var c=e.collideRect(i),a=t.collideRect(r);return cc.rectIntersectsRect(c,a)},_movingBackground:function(e){var t=16*e,i=this._backSkyHeight,r=this._backSky,c=r.getPositionY()-t,a=this._backSkyRe;if(i+c<=winSize.height){if(null!=a)throw"The memory is leaking at moving background";a=this._backSky,this._backSkyRe=this._backSky,this._backSky=BackSky.getOrCreate(),r=this._backSky,r.setPositionY(c+i-2)}else r.setPositionY(c);a&&(c=a.getPositionY()-t,c+i<0?(a.destroy(),this._backSkyRe=null):a.setPositionY(c))},scoreCounter:function(){this._state==STATE_PLAYING&&(this._time++,this._levelManager.loadLevelResource(this._time))},onGameOver:function(){var e=cc.Scene.create();e.addChild(GameOver.create()),cc.director.runScene(e)}});GameLayer.create=function(){var e=new GameLayer;return e&&e.init()?e:null},GameLayer.scene=function(){var e=cc.Scene.create(),t=cc.Sprite.createWithSpriteFrameName("#bg01.png");return t.setAnchorPoint(0,0),e.addChild(t,1),e},GameLayer.prototype.addEnemy=function(e,t,i){this._texTransparentBatch.addChild(e,t,i)},GameLayer.prototype.addExplosions=function(e){this._explosions.addChild(e)},GameLayer.prototype.addBulletHits=function(e,t){this._texOpaqueBatch.addChild(e,t)},GameLayer.prototype.addSpark=function(e){this._texOpaqueBatch.addChild(e)},GameLayer.prototype.addBullet=function(e,t,i){this._texOpaqueBatch.addChild(e,t,i)};var SysMenu=cc.Layer.extend({_ship:null,init:function(){var e=!1;if(this._super()){winSize=cc.director.getWinSize();var t=cc.Sprite.create(res.loading_png);t.setAnchorPoint(0,0),this.addChild(t,0,1);var i=cc.Sprite.createWithSpriteFrameName("#start_logo.png");i.setAnchorPoint(0,1),i.setPosition(0,480),this.addChild(i,10,1);var r=cc.Sprite.create(res.menu_png,cc.rect(133,0,133,48)),c=cc.Sprite.create(res.menu_png,cc.rect(133,48,133,48)),a=cc.Sprite.create(res.menu_png,cc.rect(133,96,133,48)),n=cc.Sprite.create(res.menu_png,cc.rect(0,0,133,48)),s=cc.Sprite.create(res.menu_png,cc.rect(0,48,133,48)),o=cc.Sprite.create(res.menu_png,cc.rect(0,96,133,48)),h=cc.Sprite.create(res.flare_jpg);this.addChild(h),h.setVisible(!1);var l=cc.MenuItemSprite.create(r,c,a,function(){this.onButtonEffect(),flareEffect(h,this,this.onNewGame)}.bind(this)),p=cc.MenuItemSprite.create(n,s,o,this.onSettings,this),u=cc.Menu.create(l,p);u.alignItemsVerticallyWithPadding(10),this.addChild(u,1,2),u.setPosition(winSize.width/2,winSize.height/2-80);var E=cc.Sprite.createWithSpriteFrameName("#powered_by.png");
E.setPosition(winSize.width/2,25),this.addChild(E,10,1),this.schedule(this.update,.1),this._ship=cc.Sprite.createWithSpriteFrameName("#fly1.png"),this.addChild(this._ship,0,4);var d=cc.p(Math.random()*winSize.width,0);this._ship.setOpacity(180),this._ship.setPosition(d),this._ship.runAction(cc.MoveBy.create(2,cc.p(Math.random()*winSize.width,d.y+winSize.height+100))),e=!0}return e},onNewGame:function(e){cc.LoaderScene.preload(g_maingame,function(){var e=cc.Scene.create();e.addChild(GameLayer.create()),cc.director.runScene(e)},this)},onSettings:function(e){this.onButtonEffect();var t=cc.Scene.create();t.addChild(SettingsLayer.create()),cc.director.runScene(t)},update:function(){if(this._ship.getPosition().y>568){var e=cc.p(Math.random()*winSize.width,10);this._ship.setPosition(e),this._ship.runAction(cc.MoveBy.create(parseInt(5*Math.random(),10),cc.p(Math.random()*winSize.width,e.y+578)))}},onButtonEffect:function(){}});SysMenu.create=function(){var e=new SysMenu;return e&&e.init()?e:null},SysMenu.scene=function(){var e=cc.Scene.create(),t=SysMenu.create();return e.addChild(t),e};var StartLayer=cc.Layer.extend({ctor:function(){this._super();var e=cc.winSize,t=cc.Sprite.create(res.BackGround_jpg);t.setPosition(e.width/2,e.height/2),this.addChild(t);var i=cc.LabelTTF.create("Hello World","Arial",38);return i.setPosition(e.width/2,e.height/2),this.addChild(i),!0}}),StartScene=cc.Scene.extend({onEnter:function(){this._super();var e=new StartLayer;this.addChild(e)}});