@using SensingCloud.Helpers
@model Sensing.Entities.Weixin.WeixinUserAction
@{
    Layout = null;
    string CurrentHost = Request.Url.Scheme + "://" + Request.Url.Host + "/weixin/Auth20CallBack";
    CurrentHost = System.Web.HttpUtility.UrlEncode(CurrentHost);
    List<Sensing.Entities.Weixin.WeixinUserAction> Ranks = ViewBag.Ranks;
}
@functions{

    public int GetShareCount()
    {
        if (Model.ActivityGame.Activity.WeixinShares == null)
            return 0;
        else
            return Model.ActivityGame.Activity.WeixinShares.Count;
    }

    public string GetCurrentDate()
    {
        if (Model.LastUpdated == null)
            return DateTime.Now.ToString("yyyy年MM月dd日");
        else
            return Model.LastUpdated.Value.ToString("yyyy年MM月dd日");
    }

    public string GetLogo()
    {
        if (string.IsNullOrEmpty(Model.ActivityGame.Activity.Group.LogoUrl))
            return "/Content/weixinImage/photoshare/logo.png";
        else
            return Model.ActivityGame.Activity.Group.LogoUrl;
    }

    public string GetShareImage()
    {
        string actionShareImage = "";
        actionShareImage = Model.ActivityGame.ActionShare.ImageLink;
        if (string.IsNullOrEmpty(actionShareImage))
        {
            actionShareImage = ConstConfig.Common_Share_Image;
        }
        if (!string.IsNullOrEmpty(actionShareImage) && !actionShareImage.StartsWith("http"))
        {
            actionShareImage = Request.Url.Scheme + "://" + Request.Url.Host + actionShareImage.Replace("\\", "/");
        }
        return actionShareImage;
    }

    public string GetOpenDate()
    {
        if (Model.ActivityGame.Activity != null)
        {
            return Model.ActivityGame.Activity.ActivityExcutedDate.ToString("yyyy.MM.dd");
        }
        else
        {
            return DateTime.Now.ToString("yyyy.MM.dd");
        }
    }

}
<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>创思星球火箭燃料助力推</title>
    <meta name='viewport' content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link href="~/Content/game/css/normalize.css" rel="stylesheet" />
    <link href="~/Content/game/css/animate.min.css" rel="stylesheet" />
    <link href="~/Content/game/css/swiper.min.css" rel="stylesheet" />
    <link href="~/Content/game/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/game/css/tron.css" rel="stylesheet" />
</head>
<body>

    <!-- Swiper -->
    <div class="swiper-container">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <div class="rulesdiv" style="width: 100%;height: 100%;position: relative;top: 0;left: 0;z-index: 5;display: none;">
                    <div style="width: 100%;height: 100%;position: absolute;top: 0;left: 0;z-index: -1;background-color: black;opacity: 0.7;"></div>
                    <img src="~/Content/game/img/tronstarImg/rules.png" style="position: absolute; height: 80%;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);z-index: 1; ">
                    <img class="zzdlbtn" src="~/Content/game/img/tronstarImg/zzdlbtn.png" style="width: 24%;position: absolute; left:50%;top:85%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);z-index: 2 ">
                </div>

                <div class="fudiv" style="width: 100%;height: 100%;position: relative;top: 0;left: 0;z-index: 10;display: none;">
                    <div style="width: 100%;height: 100%;position: absolute;top: 0;left: 0;z-index: -1;background-color: black;opacity: 0.7;"></div>
                    <img src="~/Content/game/img/tronstarImg/jianengliang.png" style="position: absolute; width: 77%;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);z-index: 1; ">
                    <img class="chaimg" src="~/Content/game/img/tronstarImg/cha.png" style="width: 10.5%;position: absolute; left:90%;top:10%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);z-index: 2 ">
                </div>

                <div style="width: 100%;height: 100%;position: absolute;top: 0;left: 0;">
                    <div style="width: 100%;height: 24%;position:absolute;top: 0;left: 0;">
                        <div style="width: 30%;height: 100%;float: left; text-align: left;">
                            <img id="rulesbtn" src="~/Content/game/img/tronstarImg/guize.png" style="height: 100%;position: absolute;top: 0;margin-left: 3%;z-index: 6">
                        </div>
                        <div style="width: 40%;height: 100%;float: left; ;padding-top: 5%;font-size: 3vh;color: #fed5ac;font-weight: bolder;">
                            <p style="line-height: 3vh">开奖时间</p>
                            <p style="line-height: 3vh">2016年正月初八</p>
                        </div>
                        <div style="width: 30%;height: 65%;float: left;position: relative;">
                            <img src="~/Content/game/img/tronstarImg/star.png" style="height: 100%;position: absolute;top: 0;right: 0;">
                        </div>
                    </div>
                    <div style="width: 100%;height: 65%;position:absolute;top: 0;left: 0;z-index: 2;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <div class="energyDiv">
                            <p id="likecountSpan" class="energy">@Model.LikeCount</p>
                            <p style="color:white;">点能量</p>
                        </div>
                        <div style="width: 100%;height: 100%;margin: 0 auto;position: relative;">
                            <div class="rocketbody">
                                <div>
                                    <img class="rocketframe" src="~/Content/game/img/tronstarImg/huojianbody.png" />
                                </div>
                                <div>
                                    <img class="header" src="@Model.WeixinUserInfo.Headimgurl"/>
                                </div>
                                <p class="headerName">@Model.WeixinUserInfo.Nickname</p>
                            </div>
                            <img class="rocketfireimg" src="~/Content/game/img/tronstarImg/huojianhuo1.png" />
                        </div>

                    </div>
                    <div style="width: 100%;height: 41%;position:absolute;bottom: 0;left: 0;">
    <img src="~/Content/game/img/tronstarImg/indexyun.png" style="position: absolute;z-index: 0;width: 100%;height: 100%;bottom: 0;left: 0;">
    <img src="~/Content/game/img/tronstarImg/yun.png" style="position: absolute;z-index: 2;width: 100%;height: 80%;bottom: 0;left: 0;">
    @if (ViewBag.Flag == "myself")
    {
                        <img src="~/Content/game/img/tronstarImg/me.png" style="position: absolute;z-index: 3;width: 100%;bottom: 10%;left: 0;" />
                        <div class="xxjtdiv">

                            <img src="~/Content/game/img/tronstarImg/xxjt.png" style="height: 60%;">
                        </div>
    }
    else
    {
                            <div style="width: 30%;height: 40%;float: left; text-align: left;position: absolute;bottom: 0;z-index: 3;">
                                <a href="" id="gotoMygame"><img src="~/Content/game/img/tronstarImg/wukong2.png" class="dwcy"></a>
                            </div>
                            <div class="xxjtdiv">
                                <img src="~/Content/game/img/tronstarImg/xxjt.png" style="height: 60%;">
                            </div>
                            <div style="width: 30%;height: 40%;float: right;text-align:right;position: absolute;bottom: 0;right: 0;z-index: 3;">
                                <img src="~/Content/game/img/tronstarImg/redyunqi.png" class="cqredyunimg">
                                <img id="wwdzimg" src="~/Content/game/img/tronstarImg/wukong1.png" rel="like" class="dwjnl">
                            </div>
                        }
                        
                    </div>
                </div>
            </div>

            <div class="swiper-slide">

                <div style="width: 100%;height: 100%;position: absolute;top: 0;left: 0;">
                    <div style="width: 100%;height: 35%;position:absolute;top: 0;left: 0;">
                        <div style="width: 30%;height: 100%;float: left; text-align: left;">
                            <img src="~/Content/game/img/tronstarImg/mingcheng.png" style="height: 100%;position: absolute;top: 0;margin-left: 3%;margin-top:3%;">
                        </div>
                        <div style="width: 40%;height: 100%;float: left; ;padding-top: 5%;font-size: 3vh;color: #fed5ac;font-weight: bolder;">
                            <p style="line-height: 3vh">开奖时间</p>
                            <p style="line-height: 3vh">2016年正月初八</p>
                        </div>
                        <div style="width: 30%;height: 43%;float: left;position: relative;">
                            <img src="~/Content/game/img/tronstarImg/star.png" style="height: 100%;position: absolute;top: 0;right: 0;">
                        </div>
                    </div>

                    <div style="width: 100%;height: 30%;position:absolute;top: 0;left: 0;z-index: 1;left:50%;top:25%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;margin-top: 23%;position: relative;">
                            <div style="height: 100%;position: relative;text-align: left;">
                                <div style="width: 60%;float: left;position: relative;">
                                    <img src="~/Content/game/img/tronstarImg/touxiang.png" style="width: 100%;position: absolute;z-index: 0;margin-left: 18%;">
                                    @if (Ranks.Count > 0)
                                    {
                                        <img src="@Ranks[0].WeixinUserInfo.Headimgurl" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                    else
                                    {
                                        <img src="~/Content/game/img/tronstarImg/header.jpg" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                </div>
                                <!--<img style="width: 55%;" src="~/Content/game/img/tronstarImg/touxiang.png">
                                -->
                                <img style="width: 100%;margin-top:70%;" src="~/Content/game/img/tronstarImg/huijian1.png">
                            </div>
                        </div>
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;margin-top: 43%;position: relative;">
                            <div style="height: 100%;position: relative;text-align: left;">
                                <div style="width: 60%;float: left;position: relative;">
                                    <img src="~/Content/game/img/tronstarImg/touxiang.png" style="width: 100%;position: absolute;z-index: 0;margin-left: 18%;">
                                    @if (Ranks.Count > 1)
                                    {
                                        <img src="@Ranks[1].WeixinUserInfo.Headimgurl" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                    else
                                    {
                                        <img src="~/Content/game/img/tronstarImg/header.jpg" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                </div>
                                <!--<img style="width: 55%;" src="~/Content/game/img/tronstarImg/touxiang.png">
                                -->
                                <img style="width: 100%;margin-top:70%;" src="~/Content/game/img/tronstarImg/huijian2.png">
                            </div>
                        </div>
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;margin-top: 53%;position: relative;">
                            <div style="height: 100%;position: relative;text-align: left;">
                                <div style="width: 60%;float: left;position: relative;">
                                    <img src="~/Content/game/img/tronstarImg/touxiang.png" style="width: 100%;position: absolute;z-index: 0;margin-left: 18%;">
                                    @if (Ranks.Count > 2)
                                    {
                                        <img src="@Ranks[2].WeixinUserInfo.Headimgurl" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                    else
                                    {
                                        <img src="~/Content/game/img/tronstarImg/header.jpg" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                </div>
                                <!--<img style="width: 55%;" src="~/Content/game/img/tronstarImg/touxiang.png">
                                -->
                                <img style="width: 100%;margin-top:70%;" src="~/Content/game/img/tronstarImg/huijian3.png">
                            </div>
                        </div>
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;margin-top: 64%;position: relative;">
                            <div style="height: 100%;position: relative;text-align: left;">
                                <div style="width: 60%;float: left;position: relative;">
                                    <img src="~/Content/game/img/tronstarImg/touxiang.png" style="width: 100%;position: absolute;z-index: 0;margin-left: 18%;">
                                    @if (Ranks.Count > 3)
                                    {
                                        <img src="@Ranks[3].WeixinUserInfo.Headimgurl" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                    else
                                    {
                                        <img src="~/Content/game/img/tronstarImg/header.jpg" style="width: 80%;position: absolute;border-radius: 50%;margin-top: 10%;margin-left: 28%;">
                                    }
                                </div>
                                <!--<img style="width: 55%;" src="~/Content/game/img/tronstarImg/touxiang.png">
                                -->
                                <img style="width: 100%;margin-top:70%;" src="~/Content/game/img/tronstarImg/huijian4.png">
                            </div>
                        </div>
                    </div>
                    <div style="width: 100%;height: 25%;position:absolute;bottom: 0;left: 0;z-index: 3;text-align: center;">
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;position: relative;color: #b74930;font-weight: bold;text-align: center">
                            
                            @if (Ranks.Count > 0)
                            {
                                <span class="pmtextspan">@Ranks[0].LikeCount</span>
                            }
                            else
                            {
                                <span class="pmtextspan">0</span>
                            }
                            <span class="pmtextspan">点</span>
                            <span class="pmtextspan">能</span>
                            <span class="pmtextspan">量</span>
                        </div>
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;position: relative;color: #b74930;font-weight: bold;text-align: center;margin-top: 10%;">
                            @if (Ranks.Count > 1)
                            {
                                <span class="pmtextspan">@Ranks[1].LikeCount</span>
                            }
                            else
                            {
                                <span class="pmtextspan">0</span>
                            }
                            <span class="pmtextspan">点</span>
                            <span class="pmtextspan">能</span>
                            <span class="pmtextspan">量</span>
                        </div>
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;position: relative;color: #b74930;font-weight: bold;text-align: center;margin-top: 13%;">
                            @if (Ranks.Count > 2)
                            {
                                <span class="pmtextspan">@Ranks[2].LikeCount</span>
                            }
                            else
                            {
                                <span class="pmtextspan">0</span>
                            }
                            <span class="pmtextspan">点</span>
                            <span class="pmtextspan">能</span>
                            <span class="pmtextspan">量</span>
                        </div>
                        <div style="width: 20%;height: 100%;margin-left:3%;float: right;position: relative;color: #b74930;font-weight: bold;text-align: center;margin-top: 3%;">
                            @if (Ranks.Count > 3)
                            {
                                <span class="pmtextspan">@Ranks[3].LikeCount</span>
                            }
                            else
                            {
                                <span class="pmtextspan">0</span>
                            }
                            <span class="pmtextspan">点</span>
                            <span class="pmtextspan">能</span>
                            <span class="pmtextspan">量</span>
                        </div>
                        <div style="height: 100%;float: left;position: absolute;left:0;bottom:0;color: #5b5b5b;font-weight: bold;text-align:center;margin-left: 2%;">
                            <span class="pmtextspan">你</span>
                            <span class="pmtextspan">有</span>
                            <span class="pmtextspan">@Model.LikeCount</span>
                            <span class="pmtextspan">点</span>
                            <span class="pmtextspan">能</span>
                            <span class="pmtextspan">量</span>
                        </div>
                    </div>

                    <div style="width: 100%;height: 41%;position:absolute;bottom: 0;left: 0;">
                        <img src="~/Content/game/img/tronstarImg/yun.png" style="position: absolute;z-index: 2;width: 100%;height: 80%;bottom: 0;left: 0;">

                        <div class="xxjtdiv">
                            <img src="~/Content/game/img/tronstarImg/xxjt.png" style="height: 60%;">
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide">
                <div style="width: 100%;height: 100%;position: absolute;top: 0;left: 0;">
                    <div style="width: 100%;height: 60%;position:absolute;top: 0;left: 0;text-align: center;">
                        <img src="~/Content/game/img/tronstarImg/zhuan.png" style="position: absolute;z-index: 2;width: 85.7%;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/xingqiu.png" style="position: absolute;z-index: 2;width: 46.3%;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                    </div>
                    <div style="width: 100%;height: 40%;position:absolute;bottom: 0;left: 0;text-align: center;">
                        <img src="~/Content/game/img/tronstarImg/chenjiali.png" style="position: absolute;z-index: 3;width: 16%;left:90%;top:-20%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/guangge.png" style="position: absolute;z-index: 3;width: 13.6%;left:30%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/ligang.png" style="position: absolute;z-index: 2;width: 20.5%;left:90%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/qule.png" style="position: absolute;z-index: 3;width: 16%;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/xiaotang.png" style="position: absolute;z-index: 3;width: 9.5%;left:90%;top:10%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/xiaoyong.png" style="position: absolute;z-index: 3;width: 17.8%;left:10%;top:15%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/xuge.png" style="position: absolute;z-index: 2;width: 14%;left:10%;top:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/yege.png" style="position: absolute;z-index: 3;width: 14.5%;left:70%;top:40%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                        <img src="~/Content/game/img/tronstarImg/erweima.png" style="position: absolute;z-index: 3;width: 16.9%;left:90%;top:80%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);">
                    </div>
                    <div style="width: 100%;height: 41%;position:absolute;bottom: 0;left: 0;">
                        <img src="~/Content/game/img/tronstarImg/yun.png" style="position: absolute;z-index: 2;width: 100%;height:50%;bottom: 0;left: 0;">
                        <div style="width:100%;height: 10%;text-align: center;position: absolute;bottom: 0;z-index: 3;font-size: 2vh;margin-bottom: 3%;">
                            <span style="color: #565656">了解我们</span>
                            <span>——></span>
                            <span style="color: #3976d1">
                                <a href="http://www.troncell.com">创思感知</a>
                            </span>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
    </div>
    <div style="width:14%">
        <img src="@Model.WeixinUserInfo.Headimgurl" style="border-radius:50%;width: 100%;" />
    </div>
   
    <script src="~/Scripts/jquery-2.1.4.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="~/Scripts/swiper.min.js"></script>
    <script src="~/Scripts/swiper.animate1.0.2.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script>
        wx.config({
            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: '@ViewBag.appId', // 必填，公众号的唯一标识
            timestamp: @ViewBag.timestamp, // 必填，生成签名的时间戳
            nonceStr:'@ViewBag.nonceStr', // 必填，生成签名的随机串
            signature: '@ViewBag.signature',// 必填，签名，见附录1
            jsApiList: [
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'onMenuShareQQ',
            'onMenuShareWeibo'
            ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
        });

        wx.ready(function(){
            // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
            wx.checkJsApi({
                jsApiList: [
                  'onMenuShareTimeline'
                  ,'onMenuShareAppMessage'
                  ,'onMenuShareQQ'
                   ,'onMenuShareWeibo'
                ],
                success: function (res) {
                    //alert(JSON.stringify(res));
                }
            });

            // 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口

            wx.onMenuShareAppMessage({
                title: '@Model.ActivityGame.Activity.ActivityShare.Title',
                desc: '@Model.ActivityGame.Activity.ActivityShare.Description',
                link:'https://open.weixin.qq.com/connect/oauth2/authorize?appid=@Model.WeixinUserInfo.WeixinAppID&redirect_uri=@CurrentHost&response_type=code&scope=@ViewBag.Scope&state=@ViewBag.state&component_appid=@ViewBag.ComponentAppID#wechat_redirect',
                imgUrl: '@GetShareImage()',
                type:'link',

                //trigger: function (res) {
                //    alert('用户点击发送给朋友');
                //},
                success: function (res) {
                    //分享给朋友 1
                    //分享到朋友圈 2
                    //分享到QQ 3
                    //分享到微博 4
                    //分享到QQ空间 5
                    doShareAppMessage(1);
                },
                cancel: function (res) {
                    //alert('已取消');
                },
                fail: function (res) {
                    alert(JSON.stringify(res));
                }
            });


            // 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口

            wx.onMenuShareTimeline({
                title: '@Model.ActivityGame.Activity.ActivityShare.Title',
                link:'https://open.weixin.qq.com/connect/oauth2/authorize?appid=@Model.WeixinUserInfo.WeixinAppID&redirect_uri=@CurrentHost&response_type=code&scope=@ViewBag.Scope&state=@ViewBag.state&component_appid=@ViewBag.ComponentAppID#wechat_redirect',
                imgUrl: '@GetShareImage()',
                trigger: function (res) {
                    //alert('用户点击分享到朋友圈');
                },
                success: function (res) {
                    //分享给朋友 1
                    //分享到朋友圈 2
                    //分享到QQ 3
                    //分享到微博 4
                    //分享到QQ空间 5
                    doShareAppMessage(2);
                },
                cancel: function (res) {
                    //alert('已取消');
                },
                fail: function (res) {
                    alert(JSON.stringify(res));
                }
            });
        });



        wx.error(function(res){

            // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
            alert(JSON.stringify(res));
        });


        function doShareAppMessage(shareType)
        {
            var options = {
                url: '/weixin/UpdateShare',
                method: 'post',
                data: { id: @Model.Id,shareType: shareType,fromOpenid:"@ViewBag.currentOpenId",type:"@ConstConfig.ACTION"}
            };


            $.ajax(options)
                .success(function (data1) {
                    var shacount=parseInt($("#sharecountSpan").text());
                    shacount = shacount+1;
                    $("#sharecountSpan").text(shacount);
                })
                .error(function (data1) {
                });
        }
    </script>
    <script>
        $(function () {
            var state = "@ViewBag.state";
            var index = state.indexOf(";");
            state = '@ConstConfig.ACTION'+'0'+ state.substring(index);
            var url='https://open.weixin.qq.com/connect/oauth2/authorize?appid=@Model.WeixinUserInfo.WeixinAppID&redirect_uri=@CurrentHost&response_type=code&scope=@ViewBag.Scope&state='+state+'&component_appid=@ViewBag.ComponentAppID#wechat_redirect';
            $("#gotoMygame").attr("href",url);
        });
    </script>
    <script>
        var mySwiper = new Swiper ('.swiper-container', {
            direction : 'vertical',
            pagination: '.swiper-pagination',
            mousewheelControl : true,
            onInit: function(swiper){
                swiperAnimateCache(swiper);
                swiperAnimate(swiper);
            },
            onSlideChangeEnd: function(swiper){
                swiperAnimate(swiper);
            }
        });
       
        $("#rulesbtn").click(function (e) {
            $(".rulesdiv").slideDown("fast");
        });

        $(".zzdlbtn").click(function (e) {
            $(".rulesdiv").slideUp("fast");
        });

        $(".dwcy").click(function (e) {
            $(".fudiv").slideDown("fast");
        });

        $(".chaimg").click(function (e) {
            $(".fudiv").slideUp("fast");
        });
    </script>

    <script>
        $(function () {
            $('#wwdzimg').click(function() {
                var num=0;
                var wxid=@Model.Id;
                var D=$(this).attr("rel");
                var licount=parseInt($("#likecountSpan").text());
                console.debug(licount);
                if(D == 'like')
                {
                    licount = licount+1;
                    $(this).attr("rel","unlike");
                    num+=1;
                    $(".cqredyunimg").animate({height: '40%',opacity: 1,left: '-35px'},"slow");

                    
                }
                else
                {
                    $(this).attr("rel","like");
                    num=num-1;
                    licount = licount-1;
                    $(".cqredyunimg").animate({height: '40%',opacity: 0,left: '-65px'},"slow");
                    $(".cqredyunimg").animate({height: '40%',opacity: 0,left: '0px'},"slow");
                }
                console.debug(licount);
                $("#likecountSpan").text(licount);
                var options = {
                    method: 'get',
                    data: { id: wxid,addnum:num,wholikedOpenid:"@ViewBag.currentOpenId"}
                };
                var url = "/Weixin/LikeCountChange";
                $.ajax(url, options).success(function (data) {
                    if (data == true) {
                        console.debug("点赞/取消点赞成功！")
                    } else {
                        console.error("点赞失败！")
                    }
                });
            });
        });
    </script>
</body>
</html>
